"use strict";(self.webpackChunkpropetro_site3d=self.webpackChunkpropetro_site3d||[]).push([[956],{2935:function(t,e,r){r.d(e,{L:function(){return l}});var n=r(5410),o=r(7462),a=r(2791),i=r(7760),s=r(9324),u=["anchor"],c=new i.Box3,f=new i.Vector3,l=function(t){var e=t.anchor,r=(0,n.Z)(t,u),i=a.useRef(null),l=a.useRef(null);return a.useEffect((function(){var t,e;null!=(t=i.current)&&null!=(e=t.parent)&&e.parent&&(l.current=i.current.parent,i.current.parent.parent.add(i.current))}),[]),(0,s.x)((function(){l.current&&(c.setFromObject(l.current),c.getSize(f),i.current.position.set(l.current.position.x+f.x*e[0]/2,l.current.position.y+f.y*e[1]/2,l.current.position.z+f.z*e[2]/2))})),a.createElement("group",(0,o.Z)({ref:i},r))}},5132:function(t,e,r){r.d(e,{o:function(){return Nt}});var n=r(2791),o=r(7760),a=new o.Vector3,i=new o.Vector3,s=new o.Vector3,u=new o.Vector2,c=new o.Vector2,f=new o.Vector2,l=new o.Vector3;function d(t,e,r,n,d,p,v){a.fromBufferAttribute(e,n),i.fromBufferAttribute(e,d),s.fromBufferAttribute(e,p);var h=function(t,e,r,n,a,i){return null===(i===o.BackSide?t.intersectTriangle(n,r,e,!0,a):t.intersectTriangle(e,r,n,i!==o.DoubleSide,a))?null:{distance:t.origin.distanceTo(a),point:a.clone()}}(t,a,i,s,l,v);if(h){r&&(u.fromBufferAttribute(r,n),c.fromBufferAttribute(r,d),f.fromBufferAttribute(r,p),h.uv=o.Triangle.getUV(l,a,i,s,u,c,f,new o.Vector2));var y={a:n,b:d,c:p,normal:new o.Vector3,materialIndex:0};o.Triangle.getNormal(a,i,s,y.normal),h.face=y,h.faceIndex=n}return h}function p(t,e,r,n,o){var a=3*n,i=t.index.getX(a),s=t.index.getX(a+1),u=t.index.getX(a+2),c=d(r,t.attributes.position,t.attributes.uv,i,s,u,e);return c?(c.faceIndex=n,o&&o.push(c),c):null}function v(t,e,r){return null===t?null:(t.point.applyMatrix4(e.matrixWorld),t.distance=t.point.distanceTo(r.ray.origin),t.object=e,t.distance<r.near||t.distance>r.far?null:t)}var h=r(1413),y=r(7762),m=r(4942),g=r(5671),x=r(3144),w=1.25,b=32,P=65535,B=Math.pow(2,-24),T=r(3433),A=(0,x.Z)((function t(){(0,g.Z)(this,t)}));function M(t,e,r){return r.min.x=e[t],r.min.y=e[t+1],r.min.z=e[t+2],r.max.x=e[t+3],r.max.y=e[t+4],r.max.z=e[t+5],r}function V(t){for(var e=-1,r=-1/0,n=0;n<3;n++){var o=t[n+3]-t[n];o>r&&(r=o,e=n)}return e}function S(t,e){e.set(t)}function F(t,e,r){for(var n,o,a=0;a<3;a++){var i=a+3;n=t[a],o=e[a],r[a]=n<o?n:o,n=t[i],o=e[i],r[i]=n>o?n:o}}function k(t,e,r){for(var n=0;n<3;n++){var o=e[t+2*n],a=e[t+2*n+1],i=o-a,s=o+a;i<r[n]&&(r[n]=i),s>r[n+3]&&(r[n+3]=s)}}function C(t){var e=t[3]-t[0],r=t[4]-t[1],n=t[5]-t[2];return 2*(e*r+r*n+n*e)}function Z(t,e,r,n){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=1/0,i=1/0,s=1/0,u=-1/0,c=-1/0,f=-1/0,l=1/0,d=1/0,p=1/0,v=-1/0,h=-1/0,y=-1/0,m=null!==o,g=6*e,x=6*(e+r);g<x;g+=6){var w=t[g+0],b=t[g+1],P=w-b,B=w+b;P<a&&(a=P),B>u&&(u=B),m&&w<l&&(l=w),m&&w>v&&(v=w);var T=t[g+2],A=t[g+3],M=T-A,V=T+A;M<i&&(i=M),V>c&&(c=V),m&&T<d&&(d=T),m&&T>h&&(h=T);var S=t[g+4],F=t[g+5],k=S-F,C=S+F;k<s&&(s=k),C>f&&(f=C),m&&S<p&&(p=S),m&&S>y&&(y=S)}n[0]=a,n[1]=i,n[2]=s,n[3]=u,n[4]=c,n[5]=f,m&&(o[0]=l,o[1]=d,o[2]=p,o[3]=v,o[4]=h,o[5]=y)}function U(t,e,r,n,o){for(var a=r,i=r+n-1,s=o.pos,u=2*o.axis;;){for(;a<=i&&e[6*a+u]<s;)a++;for(;a<=i&&e[6*i+u]>=s;)i--;if(!(a<i))return a;for(var c=0;c<3;c++){var f=t[3*a+c];t[3*a+c]=t[3*i+c],t[3*i+c]=f;var l=e[6*a+2*c+0];e[6*a+2*c+0]=e[6*i+2*c+0],e[6*i+2*c+0]=l;var d=e[6*a+2*c+1];e[6*a+2*c+1]=e[6*i+2*c+1],e[6*i+2*c+1]=d}a++,i--}}var E=32,z=function(t,e){return t.candidate-e.candidate},I=new Array(E).fill().map((function(){return{count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}})),L=new Float32Array(6);function j(t,e,r,n,o,a){var i=-1,s=0;if(0===a)-1!==(i=V(e))&&(s=(e[i]+e[i+3])/2);else if(1===a)-1!==(i=V(t))&&(s=function(t,e,r,n){for(var o=0,a=e,i=e+r;a<i;a++)o+=t[6*a+2*n];return o/r}(r,n,o,i));else if(2===a)for(var u=C(t),c=w*o,f=6*n,l=6*(n+o),d=0;d<3;d++){var p=e[d],v=(e[d+3]-p)/E;if(o<8){var h=(0,T.Z)(I);h.length=o;for(var y=0,m=f;m<l;m+=6,y++){var g=h[y];g.candidate=r[m+2*d],g.count=0;for(var x=g.bounds,b=g.leftCacheBounds,P=g.rightCacheBounds,B=0;B<3;B++)P[B]=1/0,P[B+3]=-1/0,b[B]=1/0,b[B+3]=-1/0,x[B]=1/0,x[B+3]=-1/0;k(m,r,x)}h.sort(z);for(var A=o,M=0;M<A;M++)for(var Z=h[M];M+1<A&&h[M+1].candidate===Z.candidate;)h.splice(M+1,1),A--;for(var U=f;U<l;U+=6)for(var j=r[U+2*d],q=0;q<A;q++){var _=h[q];j>=_.candidate?k(U,r,_.rightCacheBounds):(k(U,r,_.leftCacheBounds),_.count++)}for(var H=0;H<A;H++){var O=h[H],X=O.count,D=o-O.count,R=O.leftCacheBounds,N=O.rightCacheBounds,G=0;0!==X&&(G=C(R)/u);var Y=0;0!==D&&(Y=C(N)/u);var W=1+w*(G*X+Y*D);W<c&&(i=d,c=W,s=O.candidate)}}else{for(var K=0;K<E;K++){var J=I[K];J.count=0,J.candidate=p+v+K*v;for(var Q=J.bounds,$=0;$<3;$++)Q[$]=1/0,Q[$+3]=-1/0}for(var tt=f;tt<l;tt+=6){var et=~~((r[tt+2*d]-p)/v);et>=E&&(et=31);var rt=I[et];rt.count++,k(tt,r,rt.bounds)}var nt=I[31];S(nt.bounds,nt.rightCacheBounds);for(var ot=30;ot>=0;ot--){var at=I[ot],it=I[ot+1];F(at.bounds,it.rightCacheBounds,at.rightCacheBounds)}for(var st=0,ut=0;ut<31;ut++){var ct=I[ut],ft=ct.count,lt=ct.bounds,dt=I[ut+1].rightCacheBounds;0!==ft&&(0===st?S(lt,L):F(lt,L,L));var pt=0,vt=0;0!==(st+=ft)&&(pt=C(L)/u);var ht=o-st;0!==ht&&(vt=C(dt)/u);var yt=1+w*(pt*st+vt*ht);yt<c&&(i=d,c=yt,s=ct.candidate)}}}else console.warn("MeshBVH: Invalid build strategy value ".concat(a," used."));return{axis:i,pos:s}}function q(t,e){function r(t){p&&p(t/v)}function n(e,o,a){var p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!h&&v>=c&&(h=!0,f&&(console.warn("MeshBVH: Max depth of ".concat(c," reached when generating BVH. Consider increasing maxDepth.")),console.warn(t))),a<=l||v>=c)return r(o+a),e.offset=o,e.count=a,e;var y=j(e.boundingData,p,s,o,a,d);if(-1===y.axis)return r(o+a),e.offset=o,e.count=a,e;var m=U(u,s,o,a,y);if(m===o||m===o+a)r(o+a),e.offset=o,e.count=a;else{e.splitAxis=y.axis;var g=new A,x=o,w=m-o;e.left=g,g.boundingData=new Float32Array(6),Z(s,x,w,g.boundingData,i),n(g,x,w,i,v+1);var b=new A,P=m,B=a-w;e.right=b,b.boundingData=new Float32Array(6),Z(s,P,B,b.boundingData,i),n(b,P,B,i,v+1)}return e}!function(t,e){if(!t.index){var r,n=t.attributes.position.count,a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;r=n>65535?new Uint32Array(new a(4*n)):new Uint16Array(new a(2*n)),t.setIndex(new o.BufferAttribute(r,1));for(var i=0;i<n;i++)r[i]=i}}(t,e);var a=new Float32Array(6),i=new Float32Array(6),s=function(t,e){var r=t.attributes.position,n=r.array,o=t.index.array,a=o.length/3,i=new Float32Array(6*a),s=r.offset||0,u=3;r.isInterleavedBufferAttribute&&(u=r.data.stride);for(var c=0;c<a;c++)for(var f=3*c,l=6*c,d=o[f+0]*u+s,p=o[f+1]*u+s,v=o[f+2]*u+s,h=0;h<3;h++){var y=n[d+h],m=n[p+h],g=n[v+h],x=y;m<x&&(x=m),g<x&&(x=g);var w=y;m>w&&(w=m),g>w&&(w=g);var b=(w-x)/2,P=2*h;i[l+P+0]=x+b,i[l+P+1]=b+(Math.abs(x)+b)*B,x<e[h]&&(e[h]=x),w>e[h+3]&&(e[h+3]=w)}return i}(t,a),u=t.index.array,c=e.maxDepth,f=e.verbose,l=e.maxLeafTris,d=e.strategy,p=e.onProgress,v=t.index.count/3,h=!1,m=[],g=function(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];var e,r=[],n=new Set,o=(0,y.Z)(t.groups);try{for(o.s();!(e=o.n()).done;){var a=e.value;n.add(a.start),n.add(a.start+a.count)}}catch(f){o.e(f)}finally{o.f()}for(var i=Array.from(n.values()).sort((function(t,e){return t-e})),s=0;s<i.length-1;s++){var u=i[s],c=i[s+1];r.push({offset:u/3,count:(c-u)/3})}return r}(t);if(1===g.length){var x=g[0],w=new A;w.boundingData=a,function(t,e,r,n){for(var o=1/0,a=1/0,i=1/0,s=-1/0,u=-1/0,c=-1/0,f=6*e,l=6*(e+r);f<l;f+=6){var d=t[f+0];d<o&&(o=d),d>s&&(s=d);var p=t[f+2];p<a&&(a=p),p>u&&(u=p);var v=t[f+4];v<i&&(i=v),v>c&&(c=v)}n[0]=o,n[1]=a,n[2]=i,n[3]=s,n[4]=u,n[5]=c}(s,x.offset,x.count,i),n(w,x.offset,x.count,i),m.push(w)}else{var b,P=(0,y.Z)(g);try{for(P.s();!(b=P.n()).done;){var T=b.value,M=new A;M.boundingData=new Float32Array(6),Z(s,T.offset,T.count,M.boundingData,i),n(M,T.offset,T.count,i),m.push(M)}}catch(V){P.e(V)}finally{P.f()}}return m}function _(t,e){for(var r,n,o,a=q(t,e),i=[],s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,u=0;u<a.length;u++){var c=a[u],f=d(c),l=new s(b*f);r=new Float32Array(l),n=new Uint32Array(l),o=new Uint16Array(l),p(0,c),i.push(l)}return i;function d(t){return t.count?1:1+d(t.left)+d(t.right)}function p(t,e){for(var a=t/4,i=t/2,s=!!e.count,u=e.boundingData,c=0;c<6;c++)r[a+c]=u[c];if(s){var f=e.offset,l=e.count;return n[a+6]=f,o[i+14]=l,o[i+15]=P,t+b}var d,v=e.left,h=e.right,y=e.splitAxis;if((d=p(t+b,v))/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[a+6]=d/4,d=p(d,h),n[a+7]=y,d}}var H=r(8301),O=r(1120),X=r(136),D=r(9388),R=function(){function t(){(0,g.Z)(this,t),this.min=1/0,this.max=-1/0}return(0,x.Z)(t,[{key:"setFromPointsField",value:function(t,e){for(var r=1/0,n=-1/0,o=0,a=t.length;o<a;o++){var i=t[o][e];r=i<r?i:r,n=i>n?i:n}this.min=r,this.max=n}},{key:"setFromPoints",value:function(t,e){for(var r=1/0,n=-1/0,o=0,a=e.length;o<a;o++){var i=e[o],s=t.dot(i);r=s<r?s:r,n=s>n?s:n}this.min=r,this.max=n}},{key:"isSeparated",value:function(t){return this.min>t.max||t.min>this.max}}]),t}();R.prototype.setFromBox=function(){var t=new o.Vector3;return function(e,r){for(var n=r.min,o=r.max,a=1/0,i=-1/0,s=0;s<=1;s++)for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){t.x=n.x*s+o.x*(1-s),t.y=n.y*u+o.y*(1-u),t.z=n.z*c+o.z*(1-c);var f=e.dot(t);a=Math.min(f,a),i=Math.max(f,i)}this.min=a,this.max=i}}();!function(){var t=new R}();var N=function(){var t=new o.Vector3,e=new o.Vector3,r=new o.Vector3;return function(n,o,a){var i=n.start,s=t,u=o.start,c=e;r.subVectors(i,u),t.subVectors(n.end,o.start),e.subVectors(o.end,o.start);var f,l,d=r.dot(c),p=c.dot(s),v=c.dot(c),h=r.dot(s),y=s.dot(s)*v-p*p;l=(d+(f=0!==y?(d*p-h*v)/y:0)*p)/v,a.x=f,a.y=l}}(),G=function(){var t=new o.Vector2,e=new o.Vector3,r=new o.Vector3;return function(n,o,a,i){N(n,o,t);var s,u,c=t.x,f=t.y;if(c>=0&&c<=1&&f>=0&&f<=1)return n.at(c,a),void o.at(f,i);if(c>=0&&c<=1)return f<0?o.at(0,i):o.at(1,i),void n.closestPointToPoint(i,!0,a);if(f>=0&&f<=1)return c<0?n.at(0,a):n.at(1,a),void o.closestPointToPoint(a,!0,i);s=c<0?n.start:n.end,u=f<0?o.start:o.end;var l=e,d=r;return n.closestPointToPoint(u,!0,e),o.closestPointToPoint(s,!0,r),l.distanceToSquared(u)<=d.distanceToSquared(s)?(a.copy(l),void i.copy(u)):(a.copy(s),void i.copy(d))}}(),Y=function(){var t=new o.Vector3,e=new o.Vector3,r=new o.Plane,n=new o.Line3;return function(o,a){var i=o.radius,s=o.center,u=a.a,c=a.b,f=a.c;if(n.start=u,n.end=c,n.closestPointToPoint(s,!0,t).distanceTo(s)<=i)return!0;if(n.start=u,n.end=f,n.closestPointToPoint(s,!0,t).distanceTo(s)<=i)return!0;if(n.start=c,n.end=f,n.closestPointToPoint(s,!0,t).distanceTo(s)<=i)return!0;var l=a.getPlane(r);if(Math.abs(l.distanceToPoint(s))<=i){var d=l.projectPoint(s,e);if(a.containsPoint(d))return!0}return!1}}();function W(t){return Math.abs(t)<1e-15}var K=function(t){(0,X.Z)(r,t);var e=(0,D.Z)(r);function r(){var t;(0,g.Z)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).isExtendedTriangle=!0,t.satAxes=new Array(4).fill().map((function(){return new o.Vector3})),t.satBounds=new Array(4).fill().map((function(){return new R})),t.points=[t.a,t.b,t.c],t.sphere=new o.Sphere,t.plane=new o.Plane,t.needsUpdate=!0,t}return(0,x.Z)(r,[{key:"intersectsSphere",value:function(t){return Y(t,this)}},{key:"update",value:function(){var t=this.a,e=this.b,r=this.c,n=this.points,o=this.satAxes,a=this.satBounds,i=o[0],s=a[0];this.getNormal(i),s.setFromPoints(i,n);var u=o[1],c=a[1];u.subVectors(t,e),c.setFromPoints(u,n);var f=o[2],l=a[2];f.subVectors(e,r),l.setFromPoints(f,n);var d=o[3],p=a[3];d.subVectors(r,t),p.setFromPoints(d,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(i,t),this.needsUpdate=!1}}]),r}(o.Triangle);K.prototype.closestPointToSegment=function(){var t=new o.Vector3,e=new o.Vector3,r=new o.Line3;return function(n){for(var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=n.start,u=n.end,c=this.points,f=1/0,l=0;l<3;l++){var d=(l+1)%3;r.start.copy(c[l]),r.end.copy(c[d]),G(r,n,t,e),(o=t.distanceToSquared(e))<f&&(f=o,a&&a.copy(t),i&&i.copy(e))}return this.closestPointToPoint(s,t),(o=s.distanceToSquared(t))<f&&(f=o,a&&a.copy(t),i&&i.copy(s)),this.closestPointToPoint(u,t),(o=u.distanceToSquared(t))<f&&(f=o,a&&a.copy(t),i&&i.copy(u)),Math.sqrt(f)}}(),K.prototype.intersectsTriangle=function(){var t=new K,e=new Array(3),r=new Array(3),n=new R,a=new R,i=new o.Vector3,s=new o.Vector3,u=new o.Vector3,c=new o.Vector3,f=new o.Line3,l=new o.Line3,d=new o.Line3;return function(o){var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(t.copy(o),t.update(),o=t);var v=this.plane,h=o.plane;if(Math.abs(v.normal.dot(h.normal))>1-1e-10){var y=this.satBounds,m=this.satAxes;r[0]=o.a,r[1]=o.b,r[2]=o.c;for(var g=0;g<4;g++){var x=y[g],w=m[g];if(n.setFromPoints(w,r),x.isSeparated(n))return!1}var b=o.satBounds,P=o.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(var B=0;B<4;B++){var T=b[B],A=P[B];if(n.setFromPoints(A,e),T.isSeparated(n))return!1}for(var M=0;M<4;M++)for(var V=m[M],S=0;S<4;S++){var F=P[S];if(i.crossVectors(V,F),n.setFromPoints(i,e),a.setFromPoints(i,r),n.isSeparated(a))return!1}return p&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}for(var k=this.points,C=!1,Z=0,U=0;U<3;U++){var E=k[U],z=k[(U+1)%3];f.start.copy(E),f.end.copy(z),f.delta(s);var I=C?l.start:l.end,L=W(h.distanceToPoint(E));if(W(h.normal.dot(s))&&L){l.copy(f),Z=2;break}var j=h.intersectLine(f,I)||L;if(j&&!W(I.distanceTo(z))){if(Z++,C)break;C=!0}}if(1===Z&&this.containsPoint(l.start))return p&&(p.start.copy(l.start),p.end.copy(l.start)),!0;if(2!==Z)return!1;for(var q=o.points,_=!1,H=0,O=0;O<3;O++){var X=q[O],D=q[(O+1)%3];f.start.copy(X),f.end.copy(D),f.delta(u);var R=_?d.start:d.end,N=W(v.distanceToPoint(X));if(W(v.normal.dot(u))&&N){d.copy(f),H=2;break}var G=v.intersectLine(f,R)||N;if(G&&!W(R.distanceTo(D))){if(H++,_)break;_=!0}}if(1===H&&this.containsPoint(d.start))return p&&(p.start.copy(d.start),p.end.copy(d.start)),!0;if(2!==H)return!1;if(l.delta(s),d.delta(u),s.dot(u)<0){var Y=d.start;d.start=d.end,d.end=Y}var K=l.start.dot(s),J=l.end.dot(s),Q=d.start.dot(s),$=d.end.dot(s),tt=J<Q,et=K<$;return(K===$||Q===J||tt!==et)&&(p&&(c.subVectors(l.start,d.start),c.dot(s)>0?p.start.copy(l.start):p.start.copy(d.start),c.subVectors(l.end,d.end),c.dot(s)<0?p.end.copy(l.end):p.end.copy(d.end)),!0)}}(),K.prototype.distanceToPoint=function(){var t=new o.Vector3;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),K.prototype.distanceToTriangle=function(){var t=new o.Vector3,e=new o.Vector3,r=["a","b","c"],n=new o.Line3,a=new o.Line3;return function(o){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=i||s?n:null;if(this.intersectsTriangle(o,u))return(i||s)&&(i&&u.getCenter(i),s&&u.getCenter(s)),0;for(var c=1/0,f=0;f<3;f++){var l=void 0,d=r[f],p=o[d];this.closestPointToPoint(p,t),(l=p.distanceToSquared(t))<c&&(c=l,i&&i.copy(t),s&&s.copy(p));var v=this[d];o.closestPointToPoint(v,t),(l=v.distanceToSquared(t))<c&&(c=l,i&&i.copy(v),s&&s.copy(t))}for(var h=0;h<3;h++){var y=r[h],m=r[(h+1)%3];n.set(this[y],this[m]);for(var g=0;g<3;g++){var x=r[g],w=r[(g+1)%3];a.set(o[x],o[w]),G(n,a,t,e);var b=t.distanceToSquared(e);b<c&&(c=b,i&&i.copy(t),s&&s.copy(e))}}return Math.sqrt(c)}}();var J=function(t){(0,X.Z)(r,t);var e=(0,D.Z)(r);function r(){var t;(0,g.Z)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).isOrientedBox=!0,t.matrix=new o.Matrix4,t.invMatrix=new o.Matrix4,t.points=new Array(8).fill().map((function(){return new o.Vector3})),t.satAxes=new Array(3).fill().map((function(){return new o.Vector3})),t.satBounds=new Array(3).fill().map((function(){return new R})),t.alignedSatBounds=new Array(3).fill().map((function(){return new R})),t.needsUpdate=!1,t}return(0,x.Z)(r,[{key:"set",value:function(t,e,n){(0,H.Z)((0,O.Z)(r.prototype),"set",this).call(this,t,e),this.matrix.copy(n),this.needsUpdate=!0}},{key:"copy",value:function(t){(0,H.Z)((0,O.Z)(r.prototype),"copy",this).call(this,t),this.matrix.copy(t.matrix),this.needsUpdate=!0}}]),r}(o.Box3);function Q(t,e,r,n){var o=t.a,a=t.b,i=t.c,s=e,u=e+1,c=e+2;r&&(s=r.getX(e),u=r.getX(e+1),c=r.getX(e+2)),o.x=n.getX(s),o.y=n.getY(s),o.z=n.getZ(s),a.x=n.getX(u),a.y=n.getY(u),a.z=n.getZ(u),i.x=n.getX(c),i.y=n.getY(c),i.z=n.getZ(c)}function $(t,e,r,n,o,a,i){for(var s=r.index,u=r.attributes.position,c=t,f=e+t;c<f;c++)if(Q(i,3*c,s,u),i.needsUpdate=!0,n(i,c,o,a))return!0;return!1}J.prototype.update=function(){for(var t=this.matrix,e=this.min,r=this.max,n=this.points,o=0;o<=1;o++)for(var a=0;a<=1;a++)for(var i=0;i<=1;i++){var s=n[1*o|2*a|4*i];s.x=o?r.x:e.x,s.y=a?r.y:e.y,s.z=i?r.z:e.z,s.applyMatrix4(t)}for(var u=this.satBounds,c=this.satAxes,f=n[0],l=0;l<3;l++){var d=c[l],p=u[l],v=n[1<<l];d.subVectors(f,v),p.setFromPoints(d,n)}var h=this.alignedSatBounds;h[0].setFromPointsField(n,"x"),h[1].setFromPointsField(n,"y"),h[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},J.prototype.intersectsBox=function(){var t=new R;return function(e){this.needsUpdate&&this.update();var r=e.min,n=e.max,o=this.satBounds,a=this.satAxes,i=this.alignedSatBounds;if(t.min=r.x,t.max=n.x,i[0].isSeparated(t))return!1;if(t.min=r.y,t.max=n.y,i[1].isSeparated(t))return!1;if(t.min=r.z,t.max=n.z,i[2].isSeparated(t))return!1;for(var s=0;s<3;s++){var u=a[s],c=o[s];if(t.setFromBox(u,e),c.isSeparated(t))return!1}return!0}}(),J.prototype.intersectsTriangle=function(){var t=new K,e=new Array(3),r=new R,n=new R,a=new o.Vector3;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(t.copy(o),t.update(),o=t);var i=this.satBounds,s=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(var u=0;u<3;u++){var c=i[u],f=s[u];if(r.setFromPoints(f,e),c.isSeparated(r))return!1}for(var l=o.satBounds,d=o.satAxes,p=this.points,v=0;v<3;v++){var h=l[v],y=d[v];if(r.setFromPoints(y,p),h.isSeparated(r))return!1}for(var m=0;m<3;m++)for(var g=s[m],x=0;x<4;x++){var w=d[x];if(a.crossVectors(g,w),r.setFromPoints(a,e),n.setFromPoints(a,p),r.isSeparated(n))return!1}return!0}}(),J.prototype.closestPointToPoint=function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},J.prototype.distanceToPoint=function(){var t=new o.Vector3;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),J.prototype.distanceToBox=function(){var t=["x","y","z"],e=new Array(12).fill().map((function(){return new o.Line3})),r=new Array(12).fill().map((function(){return new o.Line3})),n=new o.Vector3,a=new o.Vector3;return function(o){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(s||u)&&(o.getCenter(a),this.closestPointToPoint(a,n),o.closestPointToPoint(n,a),s&&s.copy(n),u&&u.copy(a)),0;for(var c=i*i,f=o.min,l=o.max,d=this.points,p=1/0,v=0;v<8;v++){var h=d[v];a.copy(h).clamp(f,l);var y=h.distanceToSquared(a);if(y<p&&(p=y,s&&s.copy(h),u&&u.copy(a),y<c))return Math.sqrt(y)}for(var m=0,g=0;g<3;g++)for(var x=0;x<=1;x++)for(var w=0;w<=1;w++){var b=(g+1)%3,P=(g+2)%3,B=x<<b|w<<P,T=1<<g|x<<b|w<<P,A=d[B],M=d[T],V=e[m];V.set(A,M);var S=t[g],F=t[b],k=t[P],C=r[m],Z=C.start,U=C.end;Z[S]=f[S],Z[F]=x?f[F]:l[F],Z[k]=w?f[k]:l[F],U[S]=l[S],U[F]=x?f[F]:l[F],U[k]=w?f[k]:l[F],m++}for(var E=0;E<=1;E++)for(var z=0;z<=1;z++)for(var I=0;I<=1;I++){a.x=E?l.x:f.x,a.y=z?l.y:f.y,a.z=I?l.z:f.z,this.closestPointToPoint(a,n);var L=a.distanceToSquared(n);if(L<p&&(p=L,s&&s.copy(n),u&&u.copy(a),L<c))return Math.sqrt(L)}for(var j=0;j<12;j++)for(var q=e[j],_=0;_<12;_++){var H=r[_];G(q,H,n,a);var O=n.distanceToSquared(a);if(O<p&&(p=O,s&&s.copy(n),u&&u.copy(a),O<c))return Math.sqrt(O)}return Math.sqrt(p)}}();var tt=function(){function t(e){(0,g.Z)(this,t),this._getNewPrimitive=e,this._primitives=[]}return(0,x.Z)(t,[{key:"getPrimitive",value:function(){var t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}},{key:"releasePrimitive",value:function(t){this._primitives.push(t)}}]),t}();function et(t,e){return 65535===e[t+15]}function rt(t,e){return e[t+6]}function nt(t,e){return e[t+14]}function ot(t){return t+8}function at(t,e){return e[t+6]}var it=new o.Box3,st=new o.Vector3,ut=["x","y","z"];function ct(t,e,r,n,o){var a=2*t,i=ht,s=yt,u=mt;if(et(a,s)){!function(t,e,r,n,o,a){for(var i=n,s=n+o;i<s;i++)p(t,e,r,i,a)}(e,r,n,rt(t,u),nt(a,s),o)}else{var c=ot(t);pt(c,i,n,st)&&ct(c,e,r,n,o);var f=at(t,u);pt(f,i,n,st)&&ct(f,e,r,n,o)}}function ft(t,e,r,n){var o=2*t,a=ht,i=yt,s=mt;if(et(o,i))return function(t,e,r,n,o){for(var a=1/0,i=null,s=n,u=n+o;s<u;s++){var c=p(t,e,r,s);c&&c.distance<a&&(i=c,a=c.distance)}return i}(e,r,n,rt(t,s),nt(o,i));var u,c,f=function(t,e){return e[t+7]}(t,s),l=ut[f],d=n.direction[l]>=0;d?(u=ot(t),c=at(t,s)):(u=at(t,s),c=ot(t));var v=pt(u,a,n,st)?ft(u,e,r,n):null;if(v){var h=v.point[l];if(d?h<=a[c+f]:h>=a[c+f+3])return v}var y=pt(c,a,n,st)?ft(c,e,r,n):null;return v&&y?v.distance<=y.distance?v:y:v||y||null}var lt=function(){var t,e,r=[],n=new tt((function(){return new o.Box3}));return function(){t=n.getPrimitive(),e=n.getPrimitive(),r.push(t,e);var o=a.apply(void 0,arguments);n.releasePrimitive(t),n.releasePrimitive(e),r.pop(),r.pop();var i=r.length;return i>0&&(e=r[i-1],t=r[i-2]),o};function a(r,n,o,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;function f(t){for(var e=2*t,r=yt,n=mt;!et(e,r);)e=2*(t=ot(t));return rt(t,n)}function l(t){for(var e=2*t,r=yt,n=mt;!et(e,r);)e=2*(t=at(t,n));return rt(t,n)+nt(e,r)}var d=2*r,p=ht,v=yt,h=mt,y=et(d,v);if(y){var m=rt(r,h),g=nt(d,v);return M(r,p,t),i(m,g,!1,c,u+r,t)}var x,w,b,P,B=ot(r),T=at(r,h),A=B,V=T;if(s&&(P=e,M(A,p,b=t),M(V,p,P),x=s(b),(w=s(P))<x)){A=T,V=B;var S=x;x=w,w=S,b=P}b||M(A,p,b=t);var F,k=et(2*A,v),C=o(b,k,x,c+1,u+A);if(2===C){var Z=f(A),U=l(A),E=U-Z;F=i(Z,E,!0,c+1,u+A,b)}else F=C&&a(A,n,o,i,s,u,c+1);if(F)return!0;M(V,p,P=e);var z,I=et(2*V,v),L=o(P,I,w,c+1,u+V);if(2===L){var j=f(V),q=l(V),_=q-j;z=i(j,_,!0,c+1,u+V,P)}else z=L&&a(V,n,o,i,s,u,c+1);return!!z}}(),dt=function(){var t=new K,e=new K,r=new o.Matrix4,n=new J,a=new J;return function o(i,s,u,c){var f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=2*i,d=ht,p=yt,v=mt;null===f&&(u.boundingBox||u.computeBoundingBox(),n.set(u.boundingBox.min,u.boundingBox.max,c),f=n);var h=et(l,p);if(!h){var y=i+8,m=v[i+6];M(y,d,it);var g=f.intersectsBox(it)&&o(y,s,u,c,f);if(g)return!0;M(m,d,it);var x=f.intersectsBox(it)&&o(m,s,u,c,f);return!!x}var w=s,b=w.index,P=w.attributes.position,B=u.index,T=u.attributes.position,A=rt(i,v),V=nt(l,p);if(r.copy(c).invert(),u.boundsTree){M(i,d,a),a.matrix.copy(r),a.needsUpdate=!0;var S=u.boundsTree.shapecast({intersectsBounds:function(t){return a.intersectsBox(t)},intersectsTriangle:function(t){t.a.applyMatrix4(c),t.b.applyMatrix4(c),t.c.applyMatrix4(c),t.needsUpdate=!0;for(var r=3*A,n=3*(V+A);r<n;r+=3)if(Q(e,r,b,P),e.needsUpdate=!0,t.intersectsTriangle(e))return!0;return!1}});return S}for(var F=3*A,k=V+3*A;F<k;F+=3){Q(t,F,b,P),t.a.applyMatrix4(r),t.b.applyMatrix4(r),t.c.applyMatrix4(r),t.needsUpdate=!0;for(var C=0,Z=B.count;C<Z;C+=3)if(Q(e,C,B,T),e.needsUpdate=!0,t.intersectsTriangle(e))return!0}}}();function pt(t,e,r,n){return M(t,e,it),r.intersectBox(it,n)}var vt,ht,yt,mt,gt=[];function xt(t){vt&&gt.push(vt),vt=t,ht=new Float32Array(t),yt=new Uint16Array(t),mt=new Uint32Array(t)}function wt(){vt=null,ht=null,yt=null,mt=null,gt.length&&xt(gt.pop())}var bt=Symbol("skip tree generation"),Pt=new o.Box3,Bt=new o.Box3,Tt=new o.Matrix4,At=new J,Mt=new J,Vt=new o.Vector3,St=new o.Vector3,Ft=new o.Vector3,kt=new o.Vector3,Ct=new o.Vector3,Zt=new o.Box3,Ut=new tt((function(){return new K})),Et=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,g.Z)(this,t),!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((r=Object.assign((0,m.Z)({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null},bt,!1),r)).useSharedArrayBuffer&&"undefined"===typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,r[bt]||(this._roots=_(e,r),!e.boundingBox&&r.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new o.Box3))),this.geometry=e}return(0,x.Z)(t,[{key:"refit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t&&Array.isArray(t)&&(t=new Set(t));var e,r,n,o,a=this.geometry,i=a.index.array,s=a.attributes.position,u=s.array,c=s.offset||0,f=3;s.isInterleavedBufferAttribute&&(f=s.data.stride);for(var l=0,d=this._roots,p=0,v=d.length;p<v;p++)e=d[p],r=new Uint32Array(e),n=new Uint16Array(e),o=new Float32Array(e),h(0,l),l+=e.byteLength;function h(e,a){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=2*e,d=n[l+15]===P;if(d){for(var p=r[e+6],v=n[l+14],y=1/0,m=1/0,g=1/0,x=-1/0,w=-1/0,b=-1/0,B=3*p,T=3*(p+v);B<T;B++){var A=i[B]*f+c,M=u[A+0],V=u[A+1],S=u[A+2];M<y&&(y=M),M>x&&(x=M),V<m&&(m=V),V>w&&(w=V),S<g&&(g=S),S>b&&(b=S)}return(o[e+0]!==y||o[e+1]!==m||o[e+2]!==g||o[e+3]!==x||o[e+4]!==w||o[e+5]!==b)&&(o[e+0]=y,o[e+1]=m,o[e+2]=g,o[e+3]=x,o[e+4]=w,o[e+5]=b,!0)}var F=e+8,k=r[e+6],C=F+a,Z=k+a,U=s,E=!1,z=!1;t?U||(E=t.has(C),z=t.has(Z),U=!E&&!z):(E=!0,z=!0);var I=U||E,L=U||z,j=!1;I&&(j=h(F,a,U));var q=!1;L&&(q=h(k,a,U));var _=j||q;if(_)for(var H=0;H<3;H++){var O=F+H,X=k+H,D=o[O],R=o[O+3],N=o[X],G=o[X+3];o[e+H]=D<N?D:N,o[e+H+3]=R>G?R:G}return _}}},{key:"traverse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this._roots[e],n=new Uint32Array(r),o=new Uint16Array(r);function a(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=2*e,u=o[s+15]===P;if(u){var c=n[e+6],f=o[s+14];t(i,u,new Float32Array(r,4*e,6),c,f)}else{var l=e+8,d=n[e+6],p=n[e+7],v=t(i,u,new Float32Array(r,4*e,6),p);v||(a(l,i+1),a(d,i+1))}}a(0)}},{key:"raycast",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.FrontSide,r=this._roots,n=this.geometry,a=[],i=e.isMaterial,s=Array.isArray(e),u=n.groups,c=i?e.side:e,f=0,l=r.length;f<l;f++){var d=s?e[u[f].materialIndex].side:c,p=a.length;if(xt(r[f]),ct(0,n,d,t,a),wt(),s)for(var v=u[f].materialIndex,h=p,y=a.length;h<y;h++)a[h].face.materialIndex=v}return a}},{key:"raycastFirst",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.FrontSide,r=this._roots,n=this.geometry,a=e.isMaterial,i=Array.isArray(e),s=null,u=n.groups,c=a?e.side:e,f=0,l=r.length;f<l;f++){var d=i?e[u[f].materialIndex].side:c;xt(r[f]);var p=ft(0,n,d,t);wt(),null!=p&&(null==s||p.distance<s.distance)&&(s=p,i&&(p.face.materialIndex=u[f].materialIndex))}return s}},{key:"intersectsGeometry",value:function(t,e){var r,n=this.geometry,o=!1,a=(0,y.Z)(this._roots);try{for(a.s();!(r=a.n()).done;){if(xt(r.value),o=dt(0,n,t,e),wt(),o)break}}catch(i){a.e(i)}finally{a.f()}return o}},{key:"shapecast",value:function(t,e,r){var n=this.geometry;if(t instanceof Function){if(e){var o=e;e=function(t,e,r,n){var a=3*e;return o(t,a,a+1,a+2,r,n)}}t={boundsTraverseOrder:r,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}var a=Ut.getPrimitive(),i=t,s=i.boundsTraverseOrder,u=i.intersectsBounds,c=i.intersectsRange,f=i.intersectsTriangle;if(c&&f){var l=c;c=function(t,e,r,o,i){return!!l(t,e,r,o,i)||$(t,e,n,f,r,o,a)}}else c||(c=f?function(t,e,r,o){return $(t,e,n,f,r,o,a)}:function(t,e,r){return r});var d,p=!1,v=0,h=(0,y.Z)(this._roots);try{for(h.s();!(d=h.n()).done;){var m=d.value;if(xt(m),p=lt(0,n,u,c,s,v),wt(),p)break;v+=m.byteLength}}catch(g){h.e(g)}finally{h.f()}return Ut.releasePrimitive(a),p}},{key:"bvhcast",value:function(t,e,r){var n=r.intersectsRanges,o=r.intersectsTriangles,a=this.geometry.index,i=this.geometry.attributes.position,s=t.geometry.index,u=t.geometry.attributes.position;Tt.copy(e).invert();var c=Ut.getPrimitive(),f=Ut.getPrimitive();if(o){var l=function(t,r,n,l,d,p,v,h){for(var y=n,m=n+l;y<m;y++){Q(f,3*y,s,u),f.a.applyMatrix4(e),f.b.applyMatrix4(e),f.c.applyMatrix4(e),f.needsUpdate=!0;for(var g=t,x=t+r;g<x;g++)if(Q(c,3*g,a,i),c.needsUpdate=!0,o(c,f,g,y,d,p,v,h))return!0}return!1};if(n){var d=n;n=function(t,e,r,n,o,a,i,s){return!!d(t,e,r,n,o,a,i,s)||l(t,e,r,n,o,a,i,s)}}else n=l}t.getBoundingBox(Bt),Bt.applyMatrix4(e);var p=this.shapecast({intersectsBounds:function(t){return Bt.intersectsBox(t)},intersectsRange:function(e,r,o,a,i,s){return Pt.copy(s),Pt.applyMatrix4(Tt),t.shapecast({intersectsBounds:function(t){return Pt.intersectsBox(t)},intersectsRange:function(t,o,s,u,c){return n(e,r,t,o,a,i,u,c)}})}});return Ut.releasePrimitive(c),Ut.releasePrimitive(f),p}},{key:"intersectsBox",value:function(t,e){return At.set(t.min,t.max,e),At.needsUpdate=!0,this.shapecast({intersectsBounds:function(t){return At.intersectsBox(t)},intersectsTriangle:function(t){return At.intersectsTriangle(t)}})}},{key:"intersectsSphere",value:function(t){return this.shapecast({intersectsBounds:function(e){return t.intersectsBox(e)},intersectsTriangle:function(e){return e.intersectsSphere(t)}})}},{key:"closestPointToGeometry",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0;t.boundingBox||t.computeBoundingBox(),At.set(t.boundingBox.min,t.boundingBox.max,e),At.needsUpdate=!0;var i=this.geometry,s=i.attributes.position,u=i.index,c=t.attributes.position,f=t.index,l=Ut.getPrimitive(),d=Ut.getPrimitive(),p=St,v=Ft,h=null,y=null;n&&(h=kt,y=Ct);var m=1/0,g=null,x=null;return Tt.copy(e).invert(),Mt.matrix.copy(Tt),this.shapecast({boundsTraverseOrder:function(t){return At.distanceToBox(t)},intersectsBounds:function(t,e,r){return r<m&&r<a&&(e&&(Mt.min.copy(t.min),Mt.max.copy(t.max),Mt.needsUpdate=!0),!0)},intersectsRange:function(r,n){if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:function(t){return Mt.distanceToBox(t)},intersectsBounds:function(t,e,r){return r<m&&r<a},intersectsRange:function(t,a){for(var i=3*t,w=3*(t+a);i<w;i+=3){Q(d,i,f,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(var b=3*r,P=3*(r+n);b<P;b+=3){Q(l,b,u,s),l.needsUpdate=!0;var B=l.distanceToTriangle(d,p,h);if(B<m&&(v.copy(p),y&&y.copy(h),m=B,g=b/3,x=i/3),B<o)return!0}}}});for(var i=0,w=f?f.count:c.count;i<w;i+=3){Q(d,i,f,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(var b=3*r,P=3*(r+n);b<P;b+=3){Q(l,b,u,s),l.needsUpdate=!0;var B=l.distanceToTriangle(d,p,h);if(B<m&&(v.copy(p),y&&y.copy(h),m=B,g=b/3,x=i/3),B<o)return!0}}}}),Ut.releasePrimitive(l),Ut.releasePrimitive(d),m===1/0?null:(r.point?r.point.copy(v):r.point=v.clone(),r.distance=m,r.faceIndex=g,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(Tt),v.applyMatrix4(Tt),n.distance=v.sub(n.point).length(),n.faceIndex=x),r)}},{key:"closestPointToPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,o=r*r,a=n*n,i=1/0,s=null;if(this.shapecast({boundsTraverseOrder:function(e){return Vt.copy(t).clamp(e.min,e.max),Vt.distanceToSquared(t)},intersectsBounds:function(t,e,r){return r<i&&r<a},intersectsTriangle:function(e,r){e.closestPointToPoint(t,Vt);var n=t.distanceToSquared(Vt);return n<i&&(St.copy(Vt),i=n,s=r),n<o}}),i===1/0)return null;var u=Math.sqrt(i);return e.point?e.point.copy(St):e.point=St.clone(),e.distance=u,e.faceIndex=s,e}},{key:"getBoundingBox",value:function(t){return t.makeEmpty(),this._roots.forEach((function(e){M(0,new Float32Array(e),Zt),t.union(Zt)})),t}}],[{key:"serialize",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),t.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});r=(0,h.Z)({cloneBuffers:!0},r);var n=e.geometry,o=e._roots,a=n.getIndex();return r.cloneBuffers?{roots:o.map((function(t){return t.slice()})),index:a.array.slice()}:{roots:o,index:a.array}}},{key:"deserialize",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("boolean"===typeof n)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),t.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});n=(0,h.Z)({setIndex:!0},n);var a=e.index,i=e.roots,s=new t(r,(0,h.Z)((0,h.Z)({},n),{},(0,m.Z)({},bt,!0)));if(s._roots=i,n.setIndex){var u=r.getIndex();if(null===u){var c=new o.BufferAttribute(e.index,1,!1);r.setIndex(c)}else u.array!==a&&(u.array.set(a),u.needsUpdate=!0)}return s}}]),t}(),zt=Et.prototype.raycast;Et.prototype.raycast=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');var n=e[0],o=e[1],a=e[2],i=e[3],s=zt.call(this,a,n.material);return s.forEach((function(t){(t=v(t,n,o))&&i.push(t)})),i}return zt.apply(this,e)};var It=Et.prototype.raycastFirst;Et.prototype.raycastFirst=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');var n=e[0],o=e[1],a=e[2];return v(It.call(this,a,n.material),n,o)}return It.apply(this,e)};var Lt=Et.prototype.closestPointToPoint;Et.prototype.closestPointToPoint=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),e.unshift();var n=e[1],o={};return e[1]=o,Lt.apply(this,e),n&&n.copy(o.point),o.distance}return Lt.apply(this,e)};var jt=Et.prototype.closestPointToGeometry;Et.prototype.closestPointToGeometry=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[2],o=e[3];if(n&&n.isVector3||o&&o.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');var a={},i={},s=e[1];return e[2]=a,e[3]=i,jt.apply(this,e),n&&n.copy(a.point),o&&o.copy(i.point).applyMatrix4(s),a.distance}return jt.apply(this,e)};var qt=Et.prototype.refit;Et.prototype.refit=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[0],o=e[1];if(o&&(o instanceof Set||Array.isArray(o))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');var a=new Set;o.forEach((function(t){return a.add(t)})),n&&n.forEach((function(t){return a.add(t)})),qt.call(this,a)}else qt.apply(this,e)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach((function(t){var e=Et.prototype[t];Et.prototype[t]=function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(null===n[0]||n[0].isMesh)&&(n.shift(),console.warn('MeshBVH: The function signature for "'.concat(t,'" has changed and no longer takes Mesh. See docs for new signature.'))),e.apply(this,n)}}));var _t=new o.Ray,Ht=new o.Matrix4,Ot=o.Mesh.prototype.raycast;function Xt(t,e){if(this.geometry.boundsTree){if(void 0===this.material)return;Ht.copy(this.matrixWorld).invert(),_t.copy(t.ray).applyMatrix4(Ht);var r=this.geometry.boundsTree;if(!0===t.firstHitOnly){var n=v(r.raycastFirst(_t,this.material),this,t);n&&e.push(n)}else for(var o=r.raycast(_t,this.material),a=0,i=o.length;a<i;a++){var s=v(o[a],this,t);s&&e.push(s)}}else Ot.call(this,t,e)}function Dt(t){return this.boundsTree=new Et(this,t),this.boundsTree}function Rt(){this.boundsTree=null}function Nt(t,e){n.useEffect((function(){if(t.current){t.current.raycast=Xt;var r=t.current.geometry;return r.computeBoundsTree=Dt,r.disposeBoundsTree=Rt,r.computeBoundsTree(e),function(){r.boundsTree&&r.disposeBoundsTree()}}}),[t,e])}},3630:function(t,e,r){r.d(e,{P:function(){return y}});var n=r(3433),o=r(9439),a=r(5410),i=r(7462),s=r(2791),u=r(7760),c=r(5671),f=r(3144),l=function(){var t=new u.Frustum,e=new u.Vector3,r=new u.Vector3,n=new u.Vector3,o=new u.Vector3,a=new u.Vector3,i=new u.Vector3,s=new u.Vector3,l=new u.Vector3,d=new u.Vector3,p=new u.Vector3,v=new u.Vector3,h=new u.Vector3,y=new u.Vector3,m=new u.Vector3,g=function(){function g(t,e,r){(0,c.Z)(this,g),this.camera=t,this.scene=e,this.startPoint=new u.Vector3,this.endPoint=new u.Vector3,this.collection=[],this.deep=r||Number.MAX_VALUE}return(0,f.Z)(g,[{key:"select",value:function(e,r){return this.startPoint=e||this.startPoint,this.endPoint=r||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(t,this.scene),this.collection}},{key:"updateFrustum",value:function(e,u){if(e=e||this.startPoint,u=u||this.endPoint,e.x===u.x&&(u.x+=Number.EPSILON),e.y===u.y&&(u.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera)r.copy(e),r.x=Math.min(e.x,u.x),r.y=Math.max(e.y,u.y),u.x=Math.max(e.x,u.x),u.y=Math.min(e.y,u.y),n.setFromMatrixPosition(this.camera.matrixWorld),o.copy(r),a.set(u.x,r.y,0),i.copy(u),s.set(r.x,u.y,0),o.unproject(this.camera),a.unproject(this.camera),i.unproject(this.camera),s.unproject(this.camera),h.copy(o).sub(n),y.copy(a).sub(n),m.copy(i).sub(n),h.normalize(),y.normalize(),m.normalize(),h.multiplyScalar(this.deep),y.multiplyScalar(this.deep),m.multiplyScalar(this.deep),h.add(n),y.add(n),m.add(n),(c=t.planes)[0].setFromCoplanarPoints(n,o,a),c[1].setFromCoplanarPoints(n,a,i),c[2].setFromCoplanarPoints(i,s,n),c[3].setFromCoplanarPoints(s,o,n),c[4].setFromCoplanarPoints(a,i,s),c[5].setFromCoplanarPoints(m,y,h),c[5].normal.multiplyScalar(-1);else if(this.camera.isOrthographicCamera){var c,f=Math.min(e.x,u.x),g=Math.max(e.y,u.y),x=Math.max(e.x,u.x),w=Math.min(e.y,u.y);o.set(f,g,-1),a.set(x,g,-1),i.set(x,w,-1),s.set(f,w,-1),l.set(f,g,1),d.set(x,g,1),p.set(x,w,1),v.set(f,w,1),o.unproject(this.camera),a.unproject(this.camera),i.unproject(this.camera),s.unproject(this.camera),l.unproject(this.camera),d.unproject(this.camera),p.unproject(this.camera),v.unproject(this.camera),(c=t.planes)[0].setFromCoplanarPoints(o,l,d),c[1].setFromCoplanarPoints(a,d,p),c[2].setFromCoplanarPoints(p,v,s),c[3].setFromCoplanarPoints(v,l,o),c[4].setFromCoplanarPoints(a,i,s),c[5].setFromCoplanarPoints(p,d,l),c[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}},{key:"searchChildInFrustum",value:function(t,r){if((r.isMesh||r.isLine||r.isPoints)&&void 0!==r.material&&(null===r.geometry.boundingSphere&&r.geometry.computeBoundingSphere(),e.copy(r.geometry.boundingSphere.center),e.applyMatrix4(r.matrixWorld),t.containsPoint(e)&&this.collection.push(r)),r.children.length>0)for(var n=0;n<r.children.length;n++)this.searchChildInFrustum(t,r.children[n])}}]),g}();return g}(),d=r(9324),p=r(4821),v=["box","multiple","children","onChange","border","backgroundColor","filter"],h=s.createContext([]);function y(t){var e=t.box,r=t.multiple,c=t.children,f=t.onChange,y=t.border,m=void 0===y?"1px solid #55aaff":y,g=t.backgroundColor,x=void 0===g?"rgba(75, 160, 255, 0.1)":g,w=t.filter,b=void 0===w?function(t){return t}:w,P=(0,a.Z)(t,v),B=(0,d.w)(),T=B.setEvents,A=B.camera,M=B.raycaster,V=B.gl,S=B.controls,F=B.size,k=B.get,C=s.useState(!1),Z=(0,o.Z)(C,2),U=Z[0],E=Z[1],z=s.useReducer((function(t,e){var r=e.object,o=e.shift;return void 0===r?[]:Array.isArray(r)?r:o?t.includes(r)?t.filter((function(t){return t!==r})):[r].concat((0,n.Z)(t)):t[0]===r?[]:[r]}),[]),I=(0,o.Z)(z,2),L=I[0],j=I[1];s.useEffect((function(){null==f||f(L)}),[L]);var q=s.useCallback((function(t){t.stopPropagation(),j({object:b([t.object])[0],shift:r&&t.shiftKey})}),[]),_=s.useCallback((function(t){return!U&&j({})}),[U]),H=s.useRef(null);return s.useEffect((function(){if(e&&r){var t=new l(A,H.current),n=document.createElement("div");n.style.pointerEvents="none",n.style.border=m,n.style.backgroundColor=x,n.style.position="fixed";var o=new u.Vector2,a=new u.Vector2,i=new u.Vector2,s=k().events.enabled,c=null==S?void 0:S.enabled,f=!1,d=[];return document.addEventListener("pointerdown",h,{passive:!0}),document.addEventListener("pointermove",y,{passive:!0,capture:!0}),document.addEventListener("pointerup",g,{passive:!0}),function(){document.removeEventListener("pointerdown",h),document.removeEventListener("pointermove",y),document.removeEventListener("pointerup",g)}}function v(t,e){var r=t.offsetX,n=t.offsetY,o=F.width,a=F.height;e.set(r/o*2-1,-n/a*2+1)}function h(e){e.shiftKey&&(!function(t){var e;S&&(S.enabled=!1),T({enabled:!1}),f=!0,null==(e=V.domElement.parentElement)||e.appendChild(n),n.style.left="".concat(t.clientX,"px"),n.style.top="".concat(t.clientY,"px"),n.style.width="0px",n.style.height="0px",o.x=t.clientX,o.y=t.clientY}(e),v(e,t.startPoint))}function y(e){if(f){!function(t){i.x=Math.max(o.x,t.clientX),i.y=Math.max(o.y,t.clientY),a.x=Math.min(o.x,t.clientX),a.y=Math.min(o.y,t.clientY),n.style.left="".concat(a.x,"px"),n.style.top="".concat(a.y,"px"),n.style.width="".concat(i.x-a.x,"px"),n.style.height="".concat(i.y-a.y,"px")}(e),v(e,t.endPoint);var r=t.select().sort((function(t){return t.uuid})).filter((function(t){return t.isMesh}));(0,p.Z)(r,d)||(d=r,j({object:b(r)}))}}function g(t){f&&function(){var t;f&&(S&&(S.enabled=c),T({enabled:s}),f=!1,null==(t=n.parentElement)||t.removeChild(n))}()}}),[F,M,A,S,V]),s.createElement("group",(0,i.Z)({ref:H,onClick:q,onPointerOver:function(){return E(!0)},onPointerOut:function(){return E(!1)},onPointerMissed:_},P),s.createElement(h.Provider,{value:L},c))}},7543:function(t,e,r){r.d(e,{j:function(){return o}});var n=r(2791);function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pointer",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";n.useEffect((function(){if(t)return document.body.style.cursor=e,function(){document.body.style.cursor=r}}),[t])}}}]);
//# sourceMappingURL=956.42a6d303.chunk.js.map